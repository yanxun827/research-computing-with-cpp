<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>Unit Testing</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="http://lab.hakim.se/reveal-js/css/reveal.min.css"/>
    <style type="text/css">code{white-space: pre;}</style>
    <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #303030; color: #cccccc; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; }
td.sourceCode { padding-left: 5px; }
pre, code { color: #cccccc; background-color: #303030; }
code > span.kw { color: #f0dfaf; }
code > span.dt { color: #dfdfbf; }
code > span.dv { color: #dcdccc; }
code > span.bn { color: #dca3a3; }
code > span.fl { color: #c0bed1; }
code > span.ch { color: #dca3a3; }
code > span.st { color: #cc9393; }
code > span.co { color: #7f9f7f; }
code > span.ot { color: #efef8f; }
code > span.al { color: #ffcfaf; }
code > span.fu { color: #efef8f; }
code > span.er { color: #c3bf9f; }
    </style>
    <link rel="stylesheet" href="http://lab.hakim.se/reveal-js/css/theme/night.css"/>
    <link rel="stylesheet" href="/research-computing-with-cpp//css/ucl_reveal.css"/>
    <link rel="stylesheet" href="/research-computing-with-cpp//site-styles/reveal.css"/>
  <link rel="stylesheet" media="print" href="http://lab.hakim.se/reveal-js/css/print/pdf.css" />
  <!--[if lt IE 9]>
  <script src="http://lab.hakim.se/reveal-js/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
    <h1 class="title">Unit Testing</h1>
    <h3 class="date"></h3>
</section>

<section><section id="unit-testing" class="titleslide slide level2"><h1>Unit Testing</h1></section><section id="what-is-unit-testing" class="slide level3">
<h1>What is Unit Testing?</h1>
<p>At a high level</p>
<ul>
<li>Way of testing code.</li>
<li>Unit
<ul>
<li>Smallest 'atomic' chunk of code</li>
<li>i.e. Function, could be a Class</li>
</ul></li>
<li>See also:
<ul>
<li>Integration/System Testing</li>
<li>Regression Testing</li>
<li>User Acceptance Testing</li>
</ul></li>
</ul>
</section><section id="benefits-of-unit-testing" class="slide level3">
<h1>Benefits of Unit Testing?</h1>
<ul>
<li>Certainty of correctness</li>
<li>(Scientific Rigour)</li>
<li>Influences and improves design</li>
<li>Confidence to refactor, improve</li>
</ul>
</section><section id="drawbacks-for-unit-testing" class="slide level3">
<h1>Drawbacks for Unit Testing?</h1>
<ul>
<li>Don't know how
<ul>
<li>This course will help</li>
</ul></li>
<li>Takes too much time
<ul>
<li>Really?</li>
<li>IT SAVES TIME in the long run</li>
</ul></li>
</ul>
</section><section id="unit-testing-frameworks" class="slide level3">
<h1>Unit Testing Frameworks</h1>
<p>Generally, all very similar</p>
<ul>
<li>JUnit (Java), NUnit (.net?), CppUnit, phpUnit,</li>
<li>Basically
<ul>
<li>Macros (C++), methods (Java) to test conditions</li>
<li>Macros (C++), reflection (Java) to run/discover tests</li>
<li>Ways of looking at results.
<ul>
<li>Java/Eclipse: Integrated with IDE</li>
<li>Log file or standard output</li>
</ul></li>
</ul></li>
</ul>
</section></section>
<section><section id="unit-testing-example" class="titleslide slide level2"><h1>Unit Testing Example</h1></section><section id="how-to-start" class="slide level3">
<h1>How To Start</h1>
<p>We discuss</p>
<ul>
<li>Basic Example</li>
<li>Some tips</li>
</ul>
<p>Then its down to the developer/artist.</p>
</section><section id="c-frameworks" class="slide level3">
<h1>C++ Frameworks</h1>
<p>To Consider:</p>
<ul>
<li><a href="https://github.com/philsquared/Catch">Catch</a></li>
<li><a href="https://code.google.com/p/googletest/">GoogleTest</a></li>
<li><a href="http://qt-project.org/doc/qt-4.8/qtestlib-manual.html">QTestLib</a></li>
<li><a href="http://www.boost.org/doc/libs/1_57_0/libs/test/doc/html/index.html">BoostTest</a></li>
<li><a href="http://cpptest.sourceforge.net/">CppTest</a></li>
<li><a href="http://sourceforge.net/projects/cppunit/">CppUnit</a></li>
</ul>
</section><section id="worked-example" class="slide level3">
<h1>Worked Example</h1>
<ul>
<li>Borrowed from
<ul>
<li><a href="https://github.com/philsquared/Catch/blob/master/docs/tutorial.md">Catch Tutorial</a></li>
<li>and <a href="https://code.google.com/p/googletest/wiki/V1_7_Primer">Googletest Primer</a></li>
</ul></li>
<li>We use <a href="https://github.com/philsquared/Catch">Catch</a>, so notes are compilable</li>
<li>But the concepts are the same</li>
</ul>
</section><section id="code" class="slide level3">
<h1>Code</h1>
<p>To keep it simple for now we do this in one file:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="ot">#define CATCH_CONFIG_MAIN  </span><span class="co">// This tells Catch to provide a main() - only do this in one cpp file</span>
<span class="ot">#include &quot;../catch/catch.hpp&quot;</span>

<span class="dt">unsigned</span> <span class="dt">int</span> Factorial( <span class="dt">unsigned</span> <span class="dt">int</span> number ) {
    <span class="kw">return</span> number &lt;= <span class="dv">1</span> ? number : Factorial(number<span class="dv">-1</span>)*number;
}

TEST_CASE( <span class="st">&quot;Factorials are computed&quot;</span>, <span class="st">&quot;[factorial]&quot;</span> ) {
    REQUIRE( Factorial(<span class="dv">1</span>) == <span class="dv">1</span> );
    REQUIRE( Factorial(<span class="dv">2</span>) == <span class="dv">2</span> );
    REQUIRE( Factorial(<span class="dv">3</span>) == <span class="dv">6</span> );
    REQUIRE( Factorial(<span class="dv">10</span>) == <span class="dv">3628800</span> );
}</code></pre>
<p>Produces this output when run:</p>
<pre><code>===============================================================================
All tests passed (4 assertions in 1 test case)

</code></pre>
</section><section id="principles" class="slide level3">
<h1>Principles</h1>
<p>So, typically we have</p>
<ul>
<li>Some <code>#include</code> to get test framework</li>
<li>Our code that we want to test</li>
<li>Then make some assertions</li>
</ul>
</section><section id="catch-googletest" class="slide level3">
<h1>Catch / GoogleTest</h1>
<p>For example, in <a href="https://github.com/philsquared/Catch">Catch</a>:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp">    <span class="co">// TEST_CASE(&lt;unique test name&gt;, &lt;test case name&gt;)</span>
    TEST_CASE( <span class="st">&quot;Factorials are computed&quot;</span>, <span class="st">&quot;[factorial]&quot;</span> ) {
        REQUIRE( Factorial(<span class="dv">2</span>) == <span class="dv">2</span> );
        REQUIRE( Factorial(<span class="dv">3</span>) == <span class="dv">6</span> );
    }</code></pre>
<p>In <a href="https://code.google.com/p/googletest/">GoogleTest</a>:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp">    <span class="co">// TEST(&lt;test case name&gt;, &lt;unique test name&gt;)</span>
    TEST(FactorialTest, HandlesPositiveInput) {
      EXPECT_EQ(<span class="dv">2</span>, Factorial(<span class="dv">2</span>));
      EXPECT_EQ(<span class="dv">6</span>, Factorial(<span class="dv">3</span>));
    }</code></pre>
<p>all done via C++ macros.</p>
</section><section id="tests-that-fail" class="slide level3">
<h1>Tests That Fail</h1>
<p>What about Factorial of zero? Adding</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp">    REQUIRE( Factorial(<span class="dv">0</span>) == <span class="dv">1</span> );</code></pre>
<p>Produces something like:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp">    factorial2.cc:<span class="dv">9</span>: FAILED:
    REQUIRE( Factorial(<span class="dv">0</span>) == <span class="dv">1</span> )
    with expansion:
    <span class="dv">0</span> == <span class="dv">1</span></code></pre>
</section><section id="fix-the-failing-test" class="slide level3">
<h1>Fix the Failing Test</h1>
<p>Leading to:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="ot">#define CATCH_CONFIG_MAIN  </span><span class="co">// This tells Catch to provide a main() - only do this in one cpp file</span>
<span class="ot">#include &quot;../catch/catch.hpp&quot;</span>

<span class="dt">unsigned</span> <span class="dt">int</span> Factorial( <span class="dt">unsigned</span> <span class="dt">int</span> number ) {
    <span class="co">//return number &lt;= 1 ? number : Factorial(number-1)*number;</span>
    <span class="kw">return</span> number &gt; <span class="dv">1</span> ? Factorial(number<span class="dv">-1</span>)*number : <span class="dv">1</span>;
}

TEST_CASE( <span class="st">&quot;Factorials are computed&quot;</span>, <span class="st">&quot;[factorial]&quot;</span> ) {
    REQUIRE( Factorial(<span class="dv">0</span>) == <span class="dv">1</span> );
    REQUIRE( Factorial(<span class="dv">1</span>) == <span class="dv">1</span> );
    REQUIRE( Factorial(<span class="dv">2</span>) == <span class="dv">2</span> );
    REQUIRE( Factorial(<span class="dv">3</span>) == <span class="dv">6</span> );
    REQUIRE( Factorial(<span class="dv">10</span>) == <span class="dv">3628800</span> );
}</code></pre>
<p>which passes:</p>
<pre><code>===============================================================================
All tests passed (5 assertions in 1 test case)

</code></pre>
</section><section id="test-macros" class="slide level3">
<h1>Test Macros</h1>
<p>Each framework has a variety of macros to test for failure. [Check][Check] has:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp">    REQUIRE(expression); <span class="co">// stop if fail</span>
    CHECK(expression);   <span class="co">// doesn&#39;t stop if fails</span></code></pre>
<p>if an exception is throw, its caught, reported and counts as a failure.</p>
<p>Examples:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp">    CHECK( str == <span class="st">&quot;string value&quot;</span> );
    CHECK( thisReturnsTrue() );
    REQUIRE( i == <span class="dv">42</span> );</code></pre>
<p>Others:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp">    REQUIRE_FALSE( expression )
    CHECK_FALSE( expression )
    REQUIRE_THROWS( expression ) # Must <span class="kw">throw</span> an exception
    CHECK_THROWS( expression ) # Must <span class="kw">throw</span> an exception, <span class="kw">and</span> <span class="kw">continue</span> testing
    REQUIRE_THROWS_AS( expression, exception type )
    CHECK_THROWS_AS( expression, exception type )
    REQUIRE_NOTHROW( expression )
    CHECK_NOTHROW( expression )</code></pre>
</section><section id="testing-for-failure" class="slide level3">
<h1>Testing for Failure</h1>
<p>To re-iterate:</p>
<ul>
<li>You should test failure cases
<ul>
<li>Force a failure</li>
<li>Check that exception is thrown</li>
<li>If exception is thrown, test passes</li>
<li>(Some people get confused, expecting test to fail)</li>
</ul></li>
<li>Examples
<ul>
<li>Saving to invalid file name</li>
<li>Negative numbers passed into double arguments</li>
<li>Invalid Physical quantities (e.g. -300 Kelvin)</li>
</ul></li>
</ul>
</section><section id="setuptear-down" class="slide level3">
<h1>Setup/Tear Down</h1>
<ul>
<li>Some tests require objects to exist in memory</li>
<li>These should be set up
<ul>
<li>for each test</li>
<li>for a group of tests</li>
</ul></li>
<li>Frameworks do differ in this regards</li>
</ul>
</section><section id="setuptear-down-in-catch" class="slide level3">
<h1>Setup/Tear Down in Catch</h1>
<p>Referring to the <a href="https://github.com/philsquared/Catch/blob/master/docs/tutorial.md">Catch Tutorial</a>:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp">TEST_CASE( <span class="st">&quot;vectors can be sized and resized&quot;</span>, <span class="st">&quot;[vector]&quot;</span> ) {

    std::vector&lt;<span class="dt">int</span>&gt; v( <span class="dv">5</span> );

    REQUIRE( v.size() == <span class="dv">5</span> );
    REQUIRE( v.capacity() &gt;= <span class="dv">5</span> );

    SECTION( <span class="st">&quot;resizing bigger changes size and capacity&quot;</span> ) {
        v.resize( <span class="dv">10</span> );

        REQUIRE( v.size() == <span class="dv">10</span> );
        REQUIRE( v.capacity() &gt;= <span class="dv">10</span> );
    }
    SECTION( <span class="st">&quot;resizing smaller changes size but not capacity&quot;</span> ) {
        v.resize( <span class="dv">0</span> );

        REQUIRE( v.size() == <span class="dv">0</span> );
        REQUIRE( v.capacity() &gt;= <span class="dv">5</span> );
    }
    SECTION( <span class="st">&quot;reserving bigger changes capacity but not size&quot;</span> ) {
        v.reserve( <span class="dv">10</span> );

        REQUIRE( v.size() == <span class="dv">5</span> );
        REQUIRE( v.capacity() &gt;= <span class="dv">10</span> );
    }
    SECTION( <span class="st">&quot;reserving smaller does not change size or capacity&quot;</span> ) {
        v.reserve( <span class="dv">0</span> );

        REQUIRE( v.size() == <span class="dv">5</span> );
        REQUIRE( v.capacity() &gt;= <span class="dv">5</span> );
    }
}</code></pre>
<p>So, Setup/Tear down is done before/after each section.</p>
</section></section>
<section><section id="unit-testing-tips" class="titleslide slide level2"><h1>Unit Testing Tips</h1></section><section id="c-design" class="slide level3">
<h1>C++ design</h1>
<ul>
<li>Stuff from above applies to Classes / Functions</li>
<li>Think about arguments:
<ul>
<li>Code should be hard to use incorrectly.</li>
<li>Use <code>const</code>, <code>unsigned</code> etc.</li>
<li>Testing forces you to sort these out.</li>
</ul></li>
</ul>
</section><section id="test-driven-development-tdd" class="slide level3">
<h1>Test Driven Development (TDD)</h1>
<ul>
<li>Methodology
<ol type="1">
<li>Write a test</li>
<li>Run test, should fail</li>
<li>Implement/Debug functionality</li>
<li>Run test
<ol type="1">
<li>if succeed goto 5</li>
<li>else goto 3</li>
</ol></li>
<li>Refactor to tidy up</li>
</ol></li>
</ul>
</section><section id="tdd-in-practice" class="slide level3">
<h1>TDD in practice</h1>
<ul>
<li>Aim to get good coverage</li>
<li>Some people quote 70% or more</li>
<li>What are the downsides?</li>
<li>Don't write 'brittle' tests</li>
</ul>
</section><section id="behaviour-driven-development-bdd" class="slide level3">
<h1>Behaviour Driven Development (BDD)</h1>
<ul>
<li>Behaviour Driven Development (BDD)
<ul>
<li>Refers to a <a href="https://en.wikipedia.org/wiki/Behavior-driven_development">whole area</a> of software engineering</li>
<li>With associated tools and practices</li>
<li>Think about end-user perspective</li>
<li>Think about the desired behaviour not the implementation</li>
<li>See <a href="https://codeutopia.net/blog/2015/03/01/unit-testing-tdd-and-bdd/">Jani Hartikainen</a> article.</li>
</ul></li>
</ul>
</section><section id="tdd-vs-bdd" class="slide level3">
<h1>TDD Vs BDD</h1>
<ul>
<li>TDD
<ul>
<li>Test/Design based on methods available</li>
<li>Often ties in implementation details</li>
</ul></li>
<li>BDD
<ul>
<li>Test/Design based on behaviour<br /></li>
<li>Code to interfaces (later in course)</li>
</ul></li>
<li>Subtly different</li>
<li>Aim for BDD</li>
</ul>
</section><section id="anti-pattern-1-settersgetters" class="slide level3">
<h1>Anti-Pattern 1: Setters/Getters</h1>
<p>Testing every Setter/Getter.</p>
<p>Consider:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp">   <span class="kw">class</span> Atom {

     <span class="kw">public</span>:
       <span class="dt">void</span> SetAtomicNumber(<span class="dt">const</span> <span class="dt">int</span>&amp; number) { m_AtomicNumber = number; }
       <span class="dt">int</span> GetAtomicNumber() <span class="dt">const</span> { <span class="kw">return</span> m_AtomicNumber; }
       <span class="dt">void</span> SetName(<span class="dt">const</span> std::string&amp; name) { m_Name = name; }
       std::string GetName() <span class="dt">const</span> { <span class="kw">return</span> m_Name; }
     <span class="kw">private</span>:
       <span class="dt">int</span> m_AtomicNumber;
       std::string m_Name;
   };</code></pre>
<p>and tests like:</p>
<pre class="sourceCode cpp"><code class="sourceCode cpp">    TEST_CASE( <span class="st">&quot;Testing Setters/Getters&quot;</span>, <span class="st">&quot;[Atom]&quot;</span> ) {

        Atom a;

        a.SetAtomicNumber(<span class="dv">1</span>);
        REQUIRE( a.GetAtomicNumber() == <span class="dv">1</span>);
        a.SetName(<span class="st">&quot;Hydrogen&quot;</span>);
        REQUIRE( a.GetName() == <span class="st">&quot;Hydrogen&quot;</span>);</code></pre>
<ul>
<li>It feels tedious</li>
<li>But you want good coverage</li>
<li>This often puts people off testing</li>
<li>It also produces &quot;brittle&quot;, where 1 change breaks many things</li>
</ul>
</section><section id="anti-pattern-1-suggestion." class="slide level3">
<h1>Anti-Pattern 1: Suggestion.</h1>
<ul>
<li>Focus on behaviour.
<ul>
<li>What would end-user expect to be doing?</li>
<li>How would end-user be using this class?</li>
<li>Write tests that follow the use-case</li>
<li>Gives a more logical grouping</li>
<li>One test can cover &gt; 1 function</li>
<li>i.e. move away from slavishly testing each function</li>
</ul></li>
<li>Minimise interface.
<ul>
<li>Provide the bare number of methods</li>
<li>Don't provide setters if you don't want them</li>
<li>Don't provide getters unless the user needs something</li>
<li>Less to test. Use documentation to describe why.</li>
</ul></li>
</ul>
</section><section id="anti-pattern-2-constructing-dependent-classes" class="slide level3">
<h1>Anti-Pattern 2: Constructing Dependent Classes</h1>
<ul>
<li>Sometimes, by necessity we test groups of classes</li>
<li>Or one class genuinely Has-A contained class</li>
<li>But the contained class is expensive, or could be changed in future</li>
</ul>
</section><section id="anti-pattern-2-suggestion" class="slide level3">
<h1>Anti-Pattern 2: Suggestion</h1>
<ul>
<li>Read up on [Dependency Injection][DependencyInjection]</li>
<li>Enables you to create and inject dummy test classes</li>
<li>So, testing again used to break down design, and increase flexibility</li>
</ul>
</section><section id="summary-bdd-vs-tdd" class="slide level3">
<h1>Summary BDD Vs TDD</h1>
<p>Aim to write:</p>
<ul>
<li>Most concise description of requirements as unit tests</li>
<li>Smallest amount of code to pass tests</li>
<li>... i.e. based on behaviour</li>
</ul>
</section></section>
<section><section id="any-questions" class="titleslide slide level2"><h1>Any Questions?</h1></section><section id="end-of-lecture" class="slide level3">
<h1>End of Lecture?</h1>
<ul>
<li>Example git repo, CMake, Catch template project:
<ul>
<li><a href="https://github.com/MattClarkson/CMakeCatchTemplate">https://github.com/MattClarkson/CMakeCatchTemplate</a></li>
</ul></li>
</ul>
</section></section>
    </div>
  </div>

  <script src="http://lab.hakim.se/reveal-js/lib/js/head.min.js"></script>
  <script src="http://lab.hakim.se/reveal-js/js/reveal.min.js"></script>

  <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,
        theme: 'night', // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'http://lab.hakim.se/reveal-js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'http://lab.hakim.se/reveal-js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'http://lab.hakim.se/reveal-js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
//          { src: 'http://lab.hakim.se/reveal-js/plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; }, }
//          { src: 'http://lab.hakim.se/reveal-js/plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
]});
    </script>
  </body>
</html>
